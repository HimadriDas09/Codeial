<h1><%= title %></h1>

<section id="feed-posts">
    <% if(locals.user) {%>
        <h3 style="font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;">Posts</h3>
        <form action="/posts/create" id="new-posts-form" method="POST">
            <textarea name="content" cols="40" rows="2" id="post-textarea" placeholder="Type Here..." required></textarea>
            <br>
            <input type="submit" value="Post">
        </form>    
    <% } %>

    <div id="posts-list-container">
        <ul>
            <!-- queries posts are sent to home view(to be displayed) from homeController -->
            <% for(post of posts) {%>
                <li class="post">
                    <p>
                        <% if(locals.user && locals.user.id == post.user.id) {%>
                            <small>
                                <a href="/posts/destroy/<%= post.id %>"><i class="fa-solid fa-trash" style="color: #ff2424;"></i></a>
                            </small>
                        <% } %>
                        <strong style="font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif; font-size: medium;"><%= post.content %></strong>
                        <br>
                        <small>
                            <%= post.user.name %>
                        </small>
                        <div id="post-comments"> 
                            <!-- show form(for posting comments) only to signed in user -->
                            <% if(locals.user) { %>
                                <form action="/comments/create" method="POST" id="comment-form">
                                    <input type="text" name="content" placeholder="Type here to add comments..." required autocomplete="off">
                                    <!--sending the post id as hidden value to the route-->
                                    <input type="hidden" name="post" value="<%= post._id %>">
                                    <br>
                                    <input type="submit" value="Add comment">
                                </form>
                            <% } %>

                            <div class="post-comments-list">
                                <ul id="post-comments-<%= post._id %>">
                                    <% for (comment of post.comments) {%>
                                        <p>
                                            <!-- to whom should the deleting a comment ability be available ? 
                                            user should be logged in && the user of the comment should be our logged in user > then he can delete it -->
                                            <!--locals.user &&  post.user.id == locals.user.id => if user who made the post is cur signed in : then also he can delete the comment -->
                                            <% if((locals.user && comment.user.id == locals.user.id) || (locals.user && post.user.id == locals.user.id)) {%>
                                                <small>
                                                    <a href="/comments/destroy/<%=  comment.id %>"><i class="fa-solid fa-trash" style="color: #ff2424;"></i></a>
                                                </small>
                                            <% } %>
                                            <strong style="font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif; font-size: small;"><%= comment.content %></strong>
                                            <br>
                                            <small>
                                                <%= comment.user.name %>
                                            </small>
                                        </p>
                                    <%} %>
                                </ul>
                            </div>
                        </div>
                    </p>
                </li>
            <% } %>
        </ul>
    </div>
</section>

<!--script tag for home page : for textarea-->
<script>
    const form = document.getElementById('new-posts-form');
    const textarea = document.getElementById('post-textarea');

    textarea.addEventListener('keydown', function(event) {
        if(event.key == 'Enter' && !event.shiftKey) {
            event.preventDefault();
            form.submit();//submit the form when we click enter
        }
    });
</script>

